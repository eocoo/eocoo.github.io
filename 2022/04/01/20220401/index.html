<!DOCTYPE HTML>
<html lang="en">
<head>
  <meta charset="utf-8">
  
  <title>关于代码评审 | Echo</title>
  <meta name="author" content="shanhm">
  
  <meta name="description" content="很多团队都有这样的问题，开发人员水平不一，想法不同，代码各有各的风格，Review起来又费时费力，感觉很难让所有成员保持统一风格。所以参考他人的一些经验，也总结了一些关于代码质量管理与提升的思考。">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="关于代码评审"/>
  <meta property="og:site_name" content="Echo"/>

  
    <meta property="og:image" content=""/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Echo" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-147251181-1', 'auto');
	ga('send', 'pageview');

</script>




<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --><meta name="generator" content="Hexo 7.3.0"></head>



<body>
  <header id="header" class="inner"><script async src="//js/busuanzi.js"></script>
<div class="alignleft">
  <h1><a href="/">Echo</a></h1>
  <span style="color:#736f6f; height:20px;line-height:30px;">It's a long long way to go</span>
  <h2><font style="color: #736f6f;">articles:  115 &nbsp;&nbsp;&nbsp; views: <span id="busuanzi_value_site_uv"></span></font></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/about">Abount</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>

<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article id="post-20220401" class="h-entry post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time class="dt-published" datetime="2022-03-31T16:00:00.000Z" style="margin-bottom: 10px;"><a href="/2022/04/01/20220401/" style="color: #736f6f;">2022-04-01</a></time>
      
      

  
  
    <h1 class="p-name title" itemprop="headline name">
        关于代码评审
    </h1>
    
    
  
  
  


<script async src="//js/busuanzi.js"></script>


   <span style="line-height:35px; height:35px; ">  </span>

   <font style="color: #999;"> words: 2k  &nbsp;&nbsp; views: <span id="busuanzi_value_page_pv"></span> &nbsp;&nbsp; time: 6min</font>
   
   
  
  <div class="categories">
    <a href="/categories/其它笔记/">其它笔记</a>
  </div>


   
   

   
   <hr style="background-color: #ddd; height:1px; border:none;" /><br>
   


    </header>
      
    <div class="e-content entry" itemprop="articleBody">
      
        <p>很多团队都有这样的问题，开发人员水平不一，想法不同，代码各有各的风格，Review起来又费时费力，感觉很难让所有成员保持统一风格。所以参考他人的一些经验，也总结了一些关于代码质量管理与提升的思考。</p>
<span id="more"></span>

<h3 id="评审的目的"><a href="#评审的目的" class="headerlink" title="评审的目的"></a>评审的目的</h3><p>代码评审的主要目的是希望随着时间的推移，代码能够越来越健康，而不是放任其腐化下去，越来越混乱，以至于最后不得不推倒重来。通常情况下，代码的质量都容易随着时间越来越差，尤其是在项目需求有明确时间限制，让开发觉得不得不采取一些投机取巧的方式才能完成任务的情况下。</p>
<p>评审的另一个目的是希望能提升技术氛围，鼓励团队内的技术分享。团队人员有进有出，有一些正能量的人自然也有负能量的人，这都很正常。但不管怎样，我们相信做技术的人都有意愿提升自己的技术能力，通过分享各自擅长的领域，互相学习来了解彼此，提升团队凝聚力和整体水平。</p>
<h3 id="评审的原则"><a href="#评审的原则" class="headerlink" title="评审的原则"></a>评审的原则</h3><p>评审并不是要求开发者打磨好提交中的每个细节，而是会根据项目进度和开发给出的意见重要性，适当权衡要求。最终目的是通过评审能提升整个系统的可维护性、可读性以及可理解性，而不是追求完美，也没有完美无缺的代码，只有越来越好的代码。</p>
<ul>
<li>技术和数据高于意见，鼓励质疑，尊重个人偏好；</li>
<li>遵守开发规范，保持代码风格，关于风格应该与现有的保持一致，如果以前没有风格，可以就按作者的风格来；</li>
<li>软件设计从来不是纯粹的代码风格或是个人偏好问题，它们是基于一些应当被权衡的规则而不仅仅是个人倾向；</li>
</ul>
<h3 id="评审的关注点"><a href="#评审的关注点" class="headerlink" title="评审的关注点"></a>评审的关注点</h3><p>评审中很重要的一点是要了解清楚开发者提交变更的意图，并确认其意图与实际需求或设计的吻合程度。代码质量同样重要，理想情况下，自然是希望代码具备高内聚、低耦合的特性，同时又能满足需求符合设计。</p>
<p>实际项目中，可能由于各种原因会适当放宽要求，但至少还是会要求保证代码结构清晰，逻辑层次分明，风格应该尽量的简单直白，符合直觉，让别人能比较容易地明白意图。</p>
<ul>
<li><strong>设计良好：</strong> 首先保证良好的设计，不管是需求设计还是存储设计、接口Api、或是算法流程，在实现上也应该保持与设计一致；</li>
<li><strong>提交说明：</strong> 描述清楚提交的内容，应该言简意赅，并保持语义完整。可以参考git提交规范，尽量一次变更只做一件事情；</li>
<li><strong>文件目录：</strong> 结构层次清晰，可以参考一些规范，比如MVC和DDD；</li>
<li><strong>变量命名：</strong> 语义清晰，包括文件、库表字段、以及类、方法变量等，通过命名能明白其意图，以及所属归类；</li>
<li><strong>代码风格：</strong> 保证格式化，段落层次清晰，可以通过一些空行，方法拆解，来体现逻辑的层次感；鼓励在风格上提出一些改进建议，但也要避免吹毛求疵。</li>
<li><strong>职责单一：</strong> 不管是类、接口、还是方法的定义，都应该有自己对应的角色或者职责，只是维度可能不一样，应该保证它们的分工明确，职责清晰；</li>
<li><strong>复杂度：</strong> 除非特殊处理，单个类或方法的复杂度不应该太高。设计上也应该避免引入不必要的复杂度，我们鼓励通过设计来提高可扩展性，但不应该为了扩展一些不存在的场景而过度设计，需要甄别引入的复杂度是否值得；</li>
<li><strong>代码注释：</strong> 准确必要的注释(错误的注释不如没有，不必要的注释反而增加维护负担)，尽量使用类注释，接口注释来代替行注释；</li>
<li><strong>单元测试：</strong> 必要的单元测试，比如对于一些关键的api或流程算法，应该提供充分的用例测试；</li>
<li><strong>线程安全：</strong> 如果涉及到可变共享资源的访问，需要格外留意线程安全问题；</li>
</ul>
<h3 id="评审的步骤"><a href="#评审的步骤" class="headerlink" title="评审的步骤"></a>评审的步骤</h3><p>这里主要针对的是线下组织的评审会议，为了避免会议中的讨论走题浪费时间，所以我们应该在会前明确好会议的主题流程</p>
<ol>
<li>评审范围，首先明确改动范围，比如一次变更提交，某个功能或者模块；</li>
<li>需求背景，说明改动的意图，说清楚做了什么，期望达到什么目的；</li>
<li>设计思路，怎样做的，说明设计意图；</li>
<li>代码实现，对照设计说明实现细节；</li>
<li>遗留问题，在设计实现过程中是否还有一些未完成的Todo，或者一些妥协；</li>
<li>评审意见，可以在git上以Issues的方式提出意见，由评审人落实修改；</li>
</ol>
<h3 id="代码评审的一些实践"><a href="#代码评审的一些实践" class="headerlink" title="代码评审的一些实践"></a>代码评审的一些实践</h3><ul>
<li>代码检查</li>
</ul>
<p>对于代码规范，可以使用sonar进行扫描，但这个方式的问题是太过滞后，需要质量人员去跟进和推动，并且效果也不是很好。因为大多开发都有一种习惯，如果代码写完上线之后没有问题的话，他们很少会主动去优化代码，即使你告诉他扫描有问题他也会有各种理由推脱，虽然你可以通过kpi等管理手段强制要求修改，但肯定不是一个好的方式。</p>
<p>可以使用git + checkstyle或fingbug等工具插件，来前置检查点帮助开发人员在开发过程中就发现问题并进行解决。在Maven工程中，也有代码检查相关的plugin，比如pmd插件结合阿里开发规范，如果不符合规范直接拒绝编译打包。</p>
<ul>
<li>代码提交</li>
</ul>
<p>作为开发，写清楚提交描述是必要的职业素养，至于一些不按照规范来写的开发可以直接对他们提出要求。</p>
<p>可以将提交记录与具体的开发任务关联起来，比如在comment中添加项目管理工具上的需求或问题单号。如果想避免开发人员忘记，可以通过一些工具在提交时进行检查，比如git的hook机制在代码提交前后提供了一些钩子，pre-commit或commit-msg，可以用来控制提交允许或拒绝。</p>
<ul>
<li>代码分支</li>
</ul>
<p>可以约定一些规范，来进行分支和版本的管理，比如：<br><strong>master</strong> ：主分支，限制分支的push与merge权限；<br><strong>version-{xxx}</strong> ：版本分支，从master创建，表示一个版本开发周期，版本结束后删除，打一个版本Tag然后合入主分支；<br><strong>dev-{xxx}</strong> ：开发分支，从版本分支创建，用于具体功能开发或bug修复，团队多人合作时的个人临时分支，合并后删除；   </p>
<ul>
<li>代码评审</li>
</ul>
<p>比较常见的方式是团队内定期组织相关开发人员以会议形式进行code review，如果觉得费时费力，也可以参考开源团队，利用工具在线来进行review。比如说github有pull request，gitlab有merge request，可以在代码合并的节点上进行review，这样的好处是比较开放，也方便留下review记录，以及互相的想法和沟通建议。</p>
<p><br><strong>参考：</strong>
1.<a target="_blank" rel="noopener" href="https://github.com/xindoo/eng-practices-cn">https://github.com/xindoo/eng-practices-cn</a></p>

      
    </div>
	
    <footer>
      
	  
	    
	<nav id="pagination">
	  
		  <a class="alignleft prev" href="/2022/04/05/20220405/">
		    Bean Validation对象验证标准
		  </a>
	  
	  
	  
		  <a class="alignright next" href="/2021/08/26/20210826/">
		    Netty NioEventLoop
		  </a>
	  
	  <div class="clearfix"></div>
	</nav>
	
	    
        
  
  <div class="categories">
    <a href="/categories/其它笔记/">其它笔记</a>
  </div>


        

         		        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
<script src="https://unpkg.com/gitalk@latest/dist/gitalk.min.js"></script>
<script src="/js/md5.min.js"></script>
<div id="gitalk-container"></div>
<script type="text/javascript">
    var gitalk = new Gitalk({
        clientID: 'd7beb7890a79c73a3e3d',
        clientSecret: '80ea1fc195ae4b80cbd65ec9f1ce68d59595af4b',
        id: md5(window.location.pathname),
        repo: 'eocoo.github.io',
        owner: 'eocoo',
        admin: 'eocoo'
    })
    gitalk.render('gitalk-container')
</script>                              



</div></div>
    <aside id="sidebar" class="alignright">
  


  

<script src="/js/jquery-3.4.1.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    $("#os_ul").click(function(){ $("#os_li").toggle(); });
    $("#xx_ul").click(function(){ $("#xx_li").toggle(); });
});
</script>


  

  
<div class="widget catlog">
<h3 class="title">Catlog</h3>
<ul class="entry_catlog">
<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%84%E5%AE%A1%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-text">评审的目的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%84%E5%AE%A1%E7%9A%84%E5%8E%9F%E5%88%99"><span class="toc-text">评审的原则</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%84%E5%AE%A1%E7%9A%84%E5%85%B3%E6%B3%A8%E7%82%B9"><span class="toc-text">评审的关注点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AF%84%E5%AE%A1%E7%9A%84%E6%AD%A5%E9%AA%A4"><span class="toc-text">评审的步骤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E8%AF%84%E5%AE%A1%E7%9A%84%E4%B8%80%E4%BA%9B%E5%AE%9E%E8%B7%B5"><span class="toc-text">代码评审的一些实践</span></a></li></ol>
</div>




</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">

  
  
      &copy; 2017-2025 &nbsp;&nbsp; shanhm &nbsp;&nbsp; version@1.0.0 
  
  
  
  <font style="float: right">
<script>
document.addEventListener('DOMContentLoaded', function() {
  document.querySelectorAll('figure.highlight').forEach(function(figure) {
    const copyButton = document.createElement('button');
    copyButton.className = 'code-copy-btn';
    copyButton.textContent = 'copy';
    figure.style.position = 'relative';
    figure.appendChild(copyButton);
    
    copyButton.addEventListener('click', function() {
      const codeContent = getExactCodeContent(figure);
      copyToClipboard(codeContent, copyButton);
    });
  });
  
  function getExactCodeContent(figure) {
    const codeLines = [];
    
    // 遍历所有行
    const rows = figure.querySelectorAll('tr');
    rows.forEach(row => {
      const codeTd = row.querySelector('td.code');
      if (codeTd) {
        const lineContent = getTextFromElement(codeTd);
        codeLines.push(lineContent);
      }
    });
    
    return codeLines.join('\n');
  }
  
  function getTextFromElement(element) {
    // 创建临时div来获取纯文本但保持换行
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = element.innerHTML;
    
    // 处理br标签为换行
    const breaks = tempDiv.getElementsByTagName('br');
    for (let i = breaks.length - 1; i >= 0; i--) {
      const br = breaks[i];
      br.parentNode.replaceChild(document.createTextNode('\n'), br);
    }
    
    // 获取文本内容
    let text = tempDiv.textContent || tempDiv.innerText || '';
    
    // 清理但保持缩进
    text = text.replace(/\u00A0/g, ' ') // 替换&nbsp;为普通空格
               .replace(/[ \t]+\n/g, '\n') // 清理行尾空格
               .replace(/^\s+|\s+$/g, ''); // 清理行首行尾空格
    
    return text;
  }
  
  function copyToClipboard(text, button) {
    navigator.clipboard.writeText(text).then(function() {
      showCopySuccess(button);
    }).catch(function(err) {
      console.error('copy failed: ', err);
      const textArea = document.createElement('textarea');
      textArea.value = text;
      document.body.appendChild(textArea);
      textArea.select();
      document.execCommand('copy');
      document.body.removeChild(textArea);
      showCopySuccess(button);
    });
  }
  
  function showCopySuccess(button) {
    button.textContent = 'copied!';
    button.classList.add('copied');
    setTimeout(function() {
      button.textContent = 'copy';
      button.classList.remove('copied');
    }, 2000);
  }
});
</script>
</div>
<div class="clearfix"></div>
</footer>
  
<script src="/js/jquery-3.4.1.min.js"></script>

<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ["$","$"], ["\\(","\\)"] ],
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
            processEscapes: true
        }
    });
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax();
        for (var i = 0; i < all.length; ++i)
            all[i].SourceElement().parentNode.className += ' has-jax';
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
</body>
</html>
